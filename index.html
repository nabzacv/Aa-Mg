<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AL WALAA | Enterprise Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #f39237;
            --success: #4cc9f0;
            --danger: #f72585;
            --bg: #f8f9fd;
            --white: #ffffff;
            --glass: rgba(255, 255, 255, 0.8);
            --shadow-sm: 0 4px 6px rgba(0,0,0,0.05);
            --shadow-lg: 0 20px 50px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }

        body {
            background: var(--bg);
            background: linear-gradient(135deg, #f8f9fd 0%, #e0e5ec 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø·ÙˆØ± */
        #custom-alert {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--white);
            padding: 15px 40px;
            border-radius: 50px;
            box-shadow: var(--shadow-lg);
            border-right: 5px solid var(--danger);
            z-index: 9999;
            transition: 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
        }
        .alert-active { top: 30px !important; }

        /* --- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ --- */
        .login-wrapper {
            width: 100%;
            max-width: 450px;
            perspective: 1000px;
        }

        .login-card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            padding: 50px 40px;
            border-radius: 30px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255,255,255,0.3);
            text-align: center;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .logo-box {
            background: var(--white);
            width: 90px;
            height: 90px;
            border-radius: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 20px;
            box-shadow: var(--shadow-sm);
        }

        .input-field {
            position: relative;
            margin-bottom: 25px;
        }

        .input-field input {
            width: 100%;
            padding: 15px 50px 15px 15px;
            border: 2px solid transparent;
            background: var(--white);
            border-radius: 15px;
            font-size: 1rem;
            transition: 0.3s;
            box-shadow: var(--shadow-sm);
        }

        .input-field input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(67, 97, 238, 0.15);
        }

        .input-field i {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 1.2rem;
        }

        .btn-modern {
            width: 100%;
            padding: 16px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }

        .btn-modern:hover { transform: translateY(-3px); box-shadow: 0 15px 25px rgba(67, 97, 238, 0.4); }
        .btn-modern:active { transform: translateY(1px); }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙˆØ§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) --- */
        .dashboard {
            width: 100%;
            max-width: 1100px;
            background: var(--white);
            border-radius: 35px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }

        .dash-header {
            background: var(--primary);
            padding: 30px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dash-body { padding: 40px; display: grid; grid-template-columns: 1fr 1.5fr; gap: 40px; }

        /* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        @media (max-width: 992px) {
            .dash-body { grid-template-columns: 1fr; padding: 20px; }
            .dashboard { border-radius: 0; margin: 0; }
            body { padding: 0; }
        }

        .form-section { background: var(--bg); padding: 25px; border-radius: 20px; }
        .form-section h3 { margin-bottom: 20px; color: var(--secondary); font-size: 1.1rem; }

        .item-row { display: grid; grid-template-columns: 2fr 1fr 1fr 50px; gap: 10px; margin-bottom: 15px; }

        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: right; padding: 15px; color: #777; font-weight: 600; border-bottom: 2px solid #eee; }
        td { padding: 15px; border-bottom: 1px solid #f5f5f5; vertical-align: middle; }

        .badge-qty { background: #e0e5ec; padding: 4px 10px; border-radius: 8px; font-weight: bold; }
        .delete-btn { color: var(--danger); cursor: pointer; transition: 0.3s; padding: 8px; }
        .delete-btn:hover { background: rgba(247, 37, 133, 0.1); border-radius: 50%; }

        /* Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ø®ÙÙŠ Ù„Ù„ØªØµØ¯ÙŠØ± */
        #export-zone {
            position: absolute;
            left: -9999px;
            width: 794px; /* A4 Standard */
            height: 1123px;
            background: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhOp7NbYSExZ0eqH-kimQERHFsRgZxVz-44oD2VlgCaxnn4Ryy63MMViJqMzAeBVzcUtQRQWFOsoorx_5sx69ydS5fQqj9PSpWvkq6RPrY5RpxO7XlfXAHMK7Iy_FVcdgIVsu0ks4rqOR-ZrbOewmpa0g-0huNyXhVG3GeZlNNvMIwU-b-9HwolOYlVRkY/s1600/%D9%81%D8%A7%D8%AA%D9%88%D8%B1%D9%87.png') no-repeat center;
            background-size: cover;
        }

        .hidden { display: none !important; }
        .loader { width: 22px; height: 22px; border: 3px solid #fff; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="custom-alert"><i class="fas fa-exclamation-circle" style="color:var(--danger)"></i> <span id="alert-text"></span></div>

    <div class="login-wrapper" id="loginContainer">
        <div class="login-card">
            <div class="logo-box">
                <i class="fas fa-fire-alt" style="font-size: 2.5rem; color: var(--primary);"></i>
            </div>
            <h1 style="font-size:1.8rem; margin-bottom:10px; color:var(--secondary);">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h1>
            <p style="color:#888; margin-bottom:35px;">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙˆØ§ØªÙŠØ± "Ø§Ù„ÙˆÙ„Ø§Ø¡"</p>

            <div class="input-field">
                <i class="fas fa-user-circle"></i>
                <input type="text" id="userInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            </div>

            <div class="input-field">
                <i class="fas fa-fingerprint"></i>
                <input type="password" id="passInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>

            <button class="btn-modern" onclick="validateAccess()">
                <span id="loginTxt">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                <div id="loginLoad" class="loader hidden"></div>
            </button>

            <div id="cooldownBox" class="hidden" style="margin-top:20px; color:var(--danger); font-weight:700;">
                <i class="fas fa-clock"></i> Ø§Ù†ØªØ¸Ø± <span id="secCounter">60</span> Ø«Ø§Ù†ÙŠØ©
            </div>
        </div>
    </div>

    <div class="dashboard hidden" id="dashboard">
        <div class="dash-header">
            <div>
                <h2 style="font-size:1.4rem;">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h2>
                <p style="font-size:0.8rem; opacity:0.8;">Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙˆÙ„Ø§Ø¡ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</p>
            </div>
            <i class="fas fa-shield-alt" style="font-size:1.5rem;"></i>
        </div>

        <div class="dash-body">
            <div class="form-container">
                <div class="form-section" style="margin-bottom:20px;">
                    <h3><i class="fas fa-user-tag"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
                    <div style="display:grid; gap:15px;">
                        <input type="text" id="clientName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ">
                        <input type="tel" id="clientPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„">
                        <input type="date" id="billDate">
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-cart-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª</h3>
                    <div class="item-row">
                        <input type="text" id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                        <input type="number" id="itemQty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
                        <input type="number" id="itemPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                        <button class="btn-modern" style="padding:10px;" onclick="addToGrid()"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
            </div>

            <div class="preview-container">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 style="color:var(--secondary);">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                    <span id="totalBadge" style="background:var(--accent); color:white; padding:5px 15px; border-radius:50px; font-weight:800;">0 Ø¬.Ù…</span>
                </div>

                <div class="table-container">
                    <table id="mainTable">
                        <thead>
                            <tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th></th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <button class="btn-modern" style="margin-top:30px; background:var(--secondary);" onclick="finishAndPrint()">
                    <i class="fas fa-cloud-download-alt"></i> <span id="printTxt">Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
                    <div id="printLoad" class="loader hidden"></div>
                </button>
            </div>
        </div>
    </div>

    <div id="export-zone">
        <div id="exp_date" style="position:absolute; top:215px; left:80px; font-size:20px; font-weight:700;"></div>
        <div id="exp_name" style="position:absolute; top:275px; right:185px; font-size:24px; font-weight:800; color:#2d344e;"></div>
        <div id="exp_phone" style="position:absolute; top:315px; right:185px; font-size:20px; font-weight:600;"></div>
        
        <div id="exp_items_box" style="position:absolute; top:420px; right:60px; width:680px;">
            </div>

        <div id="exp_total" style="position:absolute; bottom:220px; left:105px; font-size:32px; font-weight:900; color:#2d344e;"></div>
    </div>

    <script>
        let errorStreak = 0;
        let isWaiting = false;
        let invoiceData = [];

        function triggerAlert(msg) {
            const box = document.getElementById('custom-alert');
            document.getElementById('alert-text').innerText = msg;
            box.classList.add('alert-active');
            setTimeout(() => box.classList.remove('alert-active'), 5000);
        }

        function validateAccess() {
            if(isWaiting) return;
            const u = document.getElementById('userInput').value;
            const p = document.getElementById('passInput').value;
            const load = document.getElementById('loginLoad');
            const txt = document.getElementById('loginTxt');

            if (((u === 'Ù…ØµØ·ÙÙ‰' || u === 'Ù…ØµØ·ÙÙŠ') && p === '01096165681') || (u === 'admin' && p === '01017804647')) {
                txt.innerText = "ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚...";
                load.classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('loginContainer').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                }, 2500);
            } else {
                errorStreak++;
                vibrateDevice();
                
                if(errorStreak === 1) triggerAlert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙ„Ø· ÙÙƒØ± Ø´ÙˆÙŠÙ‡ ğŸ™‚");
                else if(errorStreak === 2) triggerAlert("Ø§Ù†Øª Ø¹Ø¨ÙŠØ· Ù…Ø§ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙ„Ø· ğŸ¤¨");
                else if(errorStreak === 3) triggerAlert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙ„Ø· ÙˆØ¯ÙŠ Ø§Ø®Ø± Ù…Ø±Ù‡ Ù„ÙŠÙƒğŸ˜ ");
                else {
                    triggerAlert("ÙŠØ§ Ø®Ùˆ*** Ù‚ÙˆÙ„ØªÙ„Ùƒ Ø§Ø³ØªÙ†Ù‰ Ø¯Ù‚ÙŠÙ‚Ù‡ Ø·Ø¨ ÙŠÙ„Ø§Ø§Ø§ Ø§Ø³ØªÙ†Ù‰ Ø¯Ù‚ÙŠÙ‚Ù‡ ÙƒÙ…Ø§Ù†ğŸ˜¡");
                    startLockDown();
                }
            }
        }

        function startLockDown() {
            isWaiting = true;
            let timer = 60;
            const box = document.getElementById('cooldownBox');
            const count = document.getElementById('secCounter');
            box.classList.remove('hidden');
            
            let timerId = setInterval(() => {
                timer--;
                count.innerText = timer;
                if(timer <= 0) {
                    clearInterval(timerId);
                    isWaiting = false;
                    box.classList.add('hidden');
                    errorStreak = 0;
                }
            }, 1000);
        }

        function vibrateDevice() { if(navigator.vibrate) navigator.vibrate([100, 50, 100]); }

        function addToGrid() {
            const name = document.getElementById('itemName').value;
            const qty = document.getElementById('itemQty').value;
            const price = document.getElementById('itemPrice').value;

            if(name && qty && price) {
                invoiceData.push({ id: Date.now(), name, qty, price, total: qty * price });
                refreshTable();
                document.getElementById('itemName').value = '';
                document.getElementById('itemQty').value = '';
                document.getElementById('itemPrice').value = '';
            } else {
                triggerAlert("Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ Ø£ÙˆÙ„Ø§Ù‹! ğŸ™„");
            }
        }

        function refreshTable() {
            const tbody = document.querySelector('#mainTable tbody');
            tbody.innerHTML = '';
            let sum = 0;
            invoiceData.forEach(item => {
                sum += item.total;
                tbody.innerHTML += `
                    <tr>
                        <td><b>${item.name}</b></td>
                        <td><span class="badge-qty">${item.qty}</span></td>
                        <td>${item.price} Ø¬.Ù…</td>
                        <td><i class="fas fa-trash-alt delete-btn" onclick="removeItem(${item.id})"></i></td>
                    </tr>`;
            });
            document.getElementById('totalBadge').innerText = sum + " Ø¬.Ù…";
        }

        function removeItem(id) {
            invoiceData = invoiceData.filter(i => i.id !== id);
            refreshTable();
        }

        async function finishAndPrint() {
            const btnTxt = document.getElementById('printTxt');
            const btnLoad = document.getElementById('printLoad');
            
            btnTxt.innerText = "Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
            btnLoad.classList.remove('hidden');

            // Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØµØ¯ÙŠØ±
            document.getElementById('exp_name').innerText = document.getElementById('clientName').value || "Ø¹Ù…ÙŠÙ„ Ø¹Ø§Ù…";
            document.getElementById('exp_phone').innerText = document.getElementById('clientPhone').value || "---";
            document.getElementById('exp_date').innerText = document.getElementById('billDate').value || new Date().toLocaleDateString();
            document.getElementById('exp_total').innerText = document.getElementById('totalBadge').innerText;

            let itemsHtml = `<table style="width:100%; text-align:right; border-spacing:0 12px; font-weight:600;">`;
            invoiceData.forEach(item => {
                itemsHtml += `<tr><td style="width:50%">${item.name}</td><td style="width:15%">${item.qty}</td><td style="width:15%">${item.price}</td><td style="width:20%">${item.total}</td></tr>`;
            });
            itemsHtml += `</table>`;
            document.getElementById('exp_items_box').innerHTML = itemsHtml;

            setTimeout(() => {
                html2canvas(document.querySelector("#export-zone"), { scale: 3 }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `ÙØ§ØªÙˆØ±Ø©_Ø§Ù„ÙˆÙ„Ø§Ø¡_${Date.now()}.png`;
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                    btnTxt.innerText = "Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©";
                    btnLoad.classList.add('hidden');
                });
            }, 2500);
        }
    </script>
</body>
</html>
